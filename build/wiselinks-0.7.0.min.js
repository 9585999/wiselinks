/*
 2012-2013 Igor Alexandrov, Alexey Solilin, Julia Egorova, Alexandr Borisov
 @preserve https://github.com/igor-alexandrov/wiselinks
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
 Public Domain
 @author Benjamin Arthur Lupton <contact@balupton.com>
 @author James Padolsey <https://gist.github.com/527683>
 Public Domain
 @author Benjamin Arthur Lupton <contact@balupton.com>
 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 @license New BSD License <http://creativecommons.org/licenses/BSD/>
*/
(function(){var c;c=function(){function c(d,e){this.page=d;this.$form=e}c.prototype.process=function(){var d;d=this;return d._include_blank_values()?d.page.load(d._url(),d._target(),d._type()):d._without_blank_values(function(){return d.page.load(d._url(),d._target(),d._type())})};c.prototype._without_blank_values=function(d){var e;e=this.$form.find("select:not(:disabled),input:not(:disabled)").filter(function(){return!$(this).val()});e.attr("disabled",!0);d();return e.attr("disabled",!1)};c.prototype._params=
function(){var d,e,b,f,c,q;d={};q=this.$form.serializeArray();f=0;for(c=q.length;f<c;f++)e=q[f],"utf8"!==e.name&&(b=-1!==e.name.indexOf("[]",e.name.length-2)?e.name.substr(0,e.name.length-2):e.name,d[b]=null!=d[b]?d[b]+(","+e.value):e.value);return d};c.prototype._include_blank_values=function(){return!0===this.$form.data("include-blank-values")};c.prototype._type=function(){return"partial"===this.$form.data("push")?"partial":"template"};c.prototype._target=function(){return this.$form.data("target")};
c.prototype._url=function(){var d,e,b,f;e=[];f=this._params();for(d in f)b=f[d],e.push(""+d+"="+encodeURIComponent(b));e=e.join("&");d=this.$form.attr("action");0<e.length&&(d+="?"+e);return d};return c}();null==window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Form=c;c=function(){function c(d,e){this.page=d;this.$link=e}c.prototype.allows_process=function(d){return!(this._cross_origin_link(d.currentTarget)||this._non_standard_click(d))};c.prototype.process=function(){var d;d="partial"===
this.$link.attr("data-push")?"partial":"template";return this.page.load(this.$link.attr("href"),this.$link.attr("data-target"),d)};c.prototype._cross_origin_link=function(d){return location.protocol!==d.protocol||location.host.split(":")[0]!==d.host.split(":")[0]};c.prototype._non_standard_click=function(d){return d.metaKey||d.ctrlKey||d.shiftKey||d.altKey};return c}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Link=c;c=function(){function c(d,e){var b;this.$target=d;this.options=
e;b=this;this.template_id=(new Date).getTime();this.request_manager=new _Wiselinks.RequestManager(this.options);b._try_target(this.$target);History.emulated.pushState&&!0===this.options.html4&&(-1===window.location.href.indexOf("#!")&&(!0===this.options.html4_normalize_path&&window.location.pathname!==this.options.html4_root_path)&&(window.location.href=""+window.location.protocol+"//          "+window.location.host+"          "+this.options.html4_root_path+"#!          "+window.location.pathname),
-1!==window.location.hash.indexOf("#!")&&b._call(b._make_state(window.location.hash.substring(2))));History.Adapter.bind(window,"statechange",function(d,e){var c;c=History.getState();return b._template_id_changed(c)?b._call(b._reset_state(c)):b._call(c)});$(document).on("click","a[data-push], a[data-replace]",function(d){var e;if((e=new _Wiselinks.Link(b,$(this))).allows_process(d))return d.preventDefault(),e.process(),!1});$(document).on("submit","form[data-push], form[data-replace]",function(d){var e;
if(e=new _Wiselinks.Form(b,$(this)))return d.preventDefault(),e.process(),!1})}c.prototype.load=function(d,e,b){null==b&&(b="template");"partial"!==b&&(this.template_id=(new Date).getTime());null!=e&&this._try_target($(e));return History.pushState({timestamp:(new Date).getTime(),template_id:this.template_id,render:b,target:e,referer:window.location.href},document.title,d)};c.prototype.reload=function(){return History.replaceState({timestamp:(new Date).getTime(),template_id:this.template_id,render:"template",
referer:window.location.href},document.title,History.getState().url)};c.prototype._call=function(d){var e;e=null!=d.data.target?$(d.data.target):this.$target;return this.request_manager.call(e,d)};c.prototype._template_id_changed=function(d){return null==d.data.template_id||d.data.template_id!==this.template_id};c.prototype._make_state=function(d,e,b,f){null==b&&(b="template");return{url:d,data:{target:e,render:b,referer:f}}};c.prototype._reset_state=function(d){null==d.data&&(d.data={});d.data.target=
null;d.data.render="template";return d};c.prototype._try_target=function(d){if(0===d.length&&"exception"===this.options.target_missing)throw Error("[Wiselinks] Target missing: `"+d.selector+"`");};return c}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.Page=c;c=function(){function c(d){this.options=null!=d?d:{}}c.prototype.call=function(d,c){var b;b=this;if(null!=this.redirected)this.redirected=null;else return b._loading(d,c),$.ajax({url:c.url,headers:{"X-Wiselinks":c.data.render,
"X-Wiselinks-Referer":c.data.referer},dataType:"html"}).done(function(f,g,k){var l,h;h=k.getResponseHeader("X-Wiselinks-Url");l=k.getResponseHeader("X-Wiselinks-Assets-Digest");if(b._assets_changed(l))return window.location.reload(!0);c=History.getState();null!=h&&h!==c.url&&b._redirect_to(h,d,c,k);d.html(f);b._title(k.getResponseHeader("X-Wiselinks-Title"));return b._done(d,g,c.url,f)}).fail(function(f,g,k){return b._fail(d,g,c.url,k)}).always(function(f,g,k){return b._always(d,g,c.url)})};c.prototype._assets_changed=
function(d){return null!=this.options.assets_digest&&this.options.assets_digest!==d};c.prototype._redirect_to=function(d,c,b,f){f&&4>f.readyState&&(f.onreadystatechange=$.noop,f.abort());this.redirected=!0;$(document).trigger("page:redirected",[c,b.data.render,d]);return History.replaceState(b.data,document.title,d)};c.prototype._loading=function(d,c){return $(document).trigger("page:loading",[d,c.data.render,c.url])};c.prototype._done=function(d,c,b,f){return $(document).trigger("page:done",[d,c,
b,f])};c.prototype._fail=function(d,c,b,f){return $(document).trigger("page:fail",[d,c,b,f])};c.prototype._always=function(d,c,b){return $(document).trigger("page:always",[d,c,b])};c.prototype._title=function(d){if(null!=d)return $(document).trigger("page:title",decodeURI(d)),document.title=decodeURI(d)};return c}();void 0===window._Wiselinks&&(window._Wiselinks={});window._Wiselinks.RequestManager=c;c=function(){function c(d,e){null==d&&(d=$("body"));this.options=null!=e?e:{};this._try_jquery();
this.options=$.extend(this._defaults(),this.options);this.enabled()&&(this.page=new _Wiselinks.Page(d,this.options))}c.prototype.enabled=function(){return!History.emulated.pushState||!0===this.options.html4};c.prototype.load=function(c,e,b){null==b&&(b="template");return this.page.load(c,e,b)};c.prototype.reload=function(){return this.page.reload()};c.prototype._defaults=function(){return{html4:!0,html4_root_path:"/",html4_normalize_path:!0,target_missing:null,assets_digest:$("meta[name='assets-digest']").attr("content")}};
c.prototype._try_jquery=function(){if(null==window.jQuery)throw Error("[Wiselinks] jQuery is not loaded");};return c}();window.Wiselinks=c}).call(this);
(function(c,q){var d=c.History=c.History||{},e=c.jQuery;if("undefined"!==typeof d.Adapter)throw Error("History.js Adapter has already been loaded...");d.Adapter={bind:function(b,c,d){e(b).bind(c,d)},trigger:function(b,c,d){e(b).trigger(c,d)},extractEventData:function(b,c,d){return c&&c.originalEvent&&c.originalEvent[b]||d&&d[b]||q},onDomLoad:function(b){e(b)}};"undefined"!==typeof d.init&&d.init()})(window);
(function(c,q){var d=c.document,e=c.setInterval||e,b=c.History=c.History||{};if("undefined"!==typeof b.initHtml4)throw Error("History.js HTML4 Support has already been loaded...");b.initHtml4=function(){if("undefined"!==typeof b.initHtml4.initialized)return!1;b.initHtml4.initialized=!0;b.enabled=!0;b.savedHashes=[];b.isLastHash=function(c){var d=b.getHashByIndex();return c===d};b.saveHash=function(c){if(b.isLastHash(c))return!1;b.savedHashes.push(c);return!0};b.getHashByIndex=function(c){var d=null;
return d="undefined"===typeof c?b.savedHashes[b.savedHashes.length-1]:0>c?b.savedHashes[b.savedHashes.length+c]:b.savedHashes[c]};b.discardedHashes={};b.discardedStates={};b.discardState=function(c,d,e){var l=b.getHashByState(c);b.discardedStates[l]={discardedState:c,backState:e,forwardState:d};return!0};b.discardHash=function(c,d,e){b.discardedHashes[c]={discardedHash:c,backState:e,forwardState:d};return!0};b.discardedState=function(c){c=b.getHashByState(c);return b.discardedStates[c]||!1};b.discardedHash=
function(c){return b.discardedHashes[c]||!1};b.recycleState=function(c){var d=b.getHashByState(c);b.discardedState(c)&&delete b.discardedStates[d];return!0};b.emulated.hashChange&&(b.hashChangeInit=function(){b.checkerFunction=null;var f="",g,k,l;b.isInternetExplorer()?(g=d.createElement("iframe"),g.setAttribute("id","historyjs-iframe"),g.style.display="none",d.body.appendChild(g),g.contentWindow.document.open(),g.contentWindow.document.close(),k="",l=!1,b.checkerFunction=function(){if(l)return!1;
l=!0;var d=b.getHash()||"",e=b.unescapeHash(g.contentWindow.document.location.hash)||"";d!==f?(f=d,e!==d&&(k=d,g.contentWindow.document.open(),g.contentWindow.document.close(),g.contentWindow.document.location.hash=b.escapeHash(d)),b.Adapter.trigger(c,"hashchange")):e!==k&&(k=e,b.setHash(e,!1));l=!1;return!0}):b.checkerFunction=function(){var d=b.getHash();d!==f&&(f=d,b.Adapter.trigger(c,"hashchange"));return!0};b.intervalList.push(e(b.checkerFunction,b.options.hashChangeInterval));return!0},b.Adapter.onDomLoad(b.hashChangeInit));
b.emulated.pushState&&(b.onHashChange=function(e){var g=b.getHashByUrl(e&&e.newURL||d.location.href);e=null;if(b.isLastHash(g))return b.busy(!1),!1;b.doubleCheckComplete();b.saveHash(g);if(g&&b.isTraditionalAnchor(g))return b.Adapter.trigger(c,"anchorchange"),b.busy(!1),!1;e=b.extractState(b.getFullUrl(g||d.location.href,!1),!0);if(b.isLastSavedState(e))return b.busy(!1),!1;b.getHashByState(e);if(g=b.discardedState(e))return b.getHashByIndex(-2)===b.getHashByState(g.forwardState)?b.back(!1):b.forward(!1),
!1;b.pushState(e.data,e.title,e.url,!1);return!0},b.Adapter.bind(c,"hashchange",b.onHashChange),b.pushState=function(e,g,k,l){if(b.getHashByUrl(k))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==l&&b.busy())return b.pushQueue({scope:b,callback:b.pushState,args:arguments,queue:l}),!1;b.busy(!0);var h=b.createStateObject(e,g,k),m=b.getHashByState(h),r=b.getState(!1),r=b.getHashByState(r),a=b.getHash();b.storeState(h);b.expectedStateId=h.id;b.recycleState(h);
if(m===r)return b.busy(!1),!1;if(m!==a&&m!==b.getShortUrl(d.location.href))return b.setHash(m,!1),!1;b.saveState(h);b.Adapter.trigger(c,"statechange");b.busy(!1);return!0},b.replaceState=function(c,d,e,l){if(b.getHashByUrl(e))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==l&&b.busy())return b.pushQueue({scope:b,callback:b.replaceState,args:arguments,queue:l}),!1;b.busy(!0);var h=b.createStateObject(c,d,e),m=b.getState(!1),r=b.getStateByIndex(-2);
b.discardState(m,h,r);b.pushState(h.data,h.title,h.url,!1);return!0});if(b.emulated.pushState&&b.getHash()&&!b.emulated.hashChange)b.Adapter.onDomLoad(function(){b.Adapter.trigger(c,"hashchange")})};"undefined"!==typeof b.init&&b.init()})(window);
(function(c,q){var d=c.console||q,e=c.document,b=c.navigator,f=c.sessionStorage||!1,g=c.setTimeout,k=c.clearTimeout,l=c.setInterval,h=c.clearInterval,m=c.JSON,r=c.alert,a=c.History=c.History||{},u=c.history;m.stringify=m.stringify||m.encode;m.parse=m.parse||m.decode;if("undefined"!==typeof a.init)throw Error("History.js Core has already been loaded...");a.init=function(){if("undefined"===typeof a.Adapter)return!1;"undefined"!==typeof a.initCore&&a.initCore();"undefined"!==typeof a.initHtml4&&a.initHtml4();
return!0};a.initCore=function(){if("undefined"!==typeof a.initCore.initialized)return!1;a.initCore.initialized=!0;a.options=a.options||{};a.options.hashChangeInterval=a.options.hashChangeInterval||100;a.options.safariPollInterval=a.options.safariPollInterval||500;a.options.doubleCheckInterval=a.options.doubleCheckInterval||500;a.options.storeInterval=a.options.storeInterval||1E3;a.options.busyDelay=a.options.busyDelay||250;a.options.debug=a.options.debug||!1;a.options.initialTitle=a.options.initialTitle||
e.title;a.intervalList=[];a.clearAllIntervals=function(){var p,b=a.intervalList;if("undefined"!==typeof b&&null!==b){for(p=0;p<b.length;p++)h(b[p]);a.intervalList=null}};a.debug=function(){a.options.debug&&a.log.apply(a,arguments)};a.log=function(){var a=!("undefined"===typeof d||"undefined"===typeof d.log||"undefined"===typeof d.log.apply),b=e.getElementById("log"),c,f,h,g;a?(f=Array.prototype.slice.call(arguments),c=f.shift(),"undefined"!==typeof d.debug?d.debug.apply(d,[c,f]):d.log.apply(d,[c,
f])):c="\n"+arguments[0]+"\n";f=1;for(h=arguments.length;f<h;++f){g=arguments[f];if("object"===typeof g&&"undefined"!==typeof m)try{g=m.stringify(g)}catch(l){}c+="\n"+g+"\n"}b?(b.value+=c+"\n-----\n",b.scrollTop=b.scrollHeight-b.clientHeight):a||r(c);return!0};a.getInternetExplorerMajorVersion=function(){var p=a.getInternetExplorerMajorVersion,b;if("undefined"!==typeof a.getInternetExplorerMajorVersion.cached)b=a.getInternetExplorerMajorVersion.cached;else{b=3;for(var c=e.createElement("div"),d=c.getElementsByTagName("i");(c.innerHTML=
"\x3c!--[if gt IE "+ ++b+"]><i></i><![endif]--\x3e")&&d[0];);b=4<b?b:!1}return p.cached=b};a.isInternetExplorer=function(){return a.isInternetExplorer.cached="undefined"!==typeof a.isInternetExplorer.cached?a.isInternetExplorer.cached:Boolean(a.getInternetExplorerMajorVersion())};a.emulated={pushState:!Boolean(c.history&&c.history.pushState&&c.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(b.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(b.userAgent))),hashChange:Boolean(!("onhashchange"in
c||"onhashchange"in e)||a.isInternetExplorer()&&8>a.getInternetExplorerMajorVersion())};a.enabled=!a.emulated.pushState;a.bugs={setHash:Boolean(!a.emulated.pushState&&"Apple Computer, Inc."===b.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(b.userAgent)),safariPoll:Boolean(!a.emulated.pushState&&"Apple Computer, Inc."===b.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(b.userAgent)),ieDoubleCheck:Boolean(a.isInternetExplorer()&&8>a.getInternetExplorerMajorVersion()),hashEscape:Boolean(a.isInternetExplorer()&&
7>a.getInternetExplorerMajorVersion())};a.isEmptyObject=function(a){for(var b in a)return!1;return!0};a.cloneObject=function(a){a?(a=m.stringify(a),a=m.parse(a)):a={};return a};a.getRootUrl=function(){var a=e.location.protocol+"//"+(e.location.hostname||e.location.host);e.location.port&&(a+=":"+e.location.port);return a+"/"};a.getBaseHref=function(){var a=e.getElementsByTagName("base"),b=null,b="";1===a.length&&(b=a[0],b=b.href.replace(/[^\/]+$/,""));(b=b.replace(/\/+$/,""))&&(b+="/");return b};a.getBaseUrl=
function(){return a.getBaseHref()||a.getBasePageUrl()||a.getRootUrl()};a.getPageUrl=function(){return((a.getState(!1,!1)||{}).url||e.location.href).replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\!/.test(a)?a:a+"/"})};a.getBasePageUrl=function(){return e.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/"};a.getFullUrl=function(b,c){var d=b,e=b.substring(0,1);c="undefined"===typeof c?!0:c;/[a-z]+\:\/\//.test(b)||(d=
"/"===e?a.getRootUrl()+b.replace(/^\/+/,""):"#"===e?a.getPageUrl().replace(/#!*/,"")+b:"?"===e?a.getPageUrl().replace(/[\?#]!*/,"")+b:c?a.getBaseUrl()+b.replace(/^(\!\/)+/,""):a.getBasePageUrl()+b.replace(/^(\!\/)+/,""));return d.replace(/\#$/,"")};a.getShortUrl=function(b){var c=a.getBaseUrl(),d=a.getRootUrl();a.emulated.pushState&&(b=b.replace(c,""));b=b.replace(d,"/");return b=("!/"+b).replace(/^(\!\/)+/g,"!/").replace(/\#$/,"")};a.store={};a.idToState=a.idToState||{};a.stateToId=a.stateToId||
{};a.urlToId=a.urlToId||{};a.storedStates=a.storedStates||[];a.savedStates=a.savedStates||[];a.normalizeStore=function(){a.store.idToState=a.store.idToState||{};a.store.urlToId=a.store.urlToId||{};a.store.stateToId=a.store.stateToId||{}};a.getState=function(b,c){"undefined"===typeof b&&(b=!0);"undefined"===typeof c&&(c=!0);var d=a.getLastSavedState();!d&&c&&(d=a.createStateObject());b&&(d=a.cloneObject(d),d.url=d.cleanUrl||d.url);return d};a.getIdByState=function(b){var c=a.extractId(b.url),d;if(!c)if(d=
a.getStateString(b),"undefined"!==typeof a.stateToId[d])c=a.stateToId[d];else if("undefined"!==typeof a.store.stateToId[d])c=a.store.stateToId[d];else{for(;c=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!==typeof a.idToState[c]||"undefined"!==typeof a.store.idToState[c];);a.stateToId[d]=c;a.idToState[c]=b}return c};a.normalizeState=function(b){var c;b&&"object"===typeof b||(b={});if("undefined"!==typeof b.normalized)return b;b.data&&"object"===typeof b.data||(b.data={});
c={normalized:!0};c.title=b.title||"";c.url=a.getFullUrl(a.unescapeString(b.url||e.location.href));c.hash=a.getShortUrl(c.url);c.data=a.cloneObject(b.data);c.id=a.getIdByState(c);c.cleanUrl=c.url.replace(/\??\&_suid.*/,"");c.url=c.cleanUrl;b=!a.isEmptyObject(c.data);if(c.title||b)c.hash=a.getShortUrl(c.url).replace(/\??\&_suid.*/,""),/\?/.test(c.hash)||(c.hash+="?"),c.hash+="&_suid="+c.id;c.hashedUrl=a.getFullUrl(c.hash);(a.emulated.pushState||a.bugs.safariPoll)&&a.hasUrlDuplicate(c)&&(c.url=c.hashedUrl);
return c};a.createStateObject=function(b,c,d){b={data:b,title:c,url:d};return b=a.normalizeState(b)};a.getStateById=function(b){b=String(b);return a.idToState[b]||a.store.idToState[b]||q};a.getStateString=function(b){b={data:a.normalizeState(b).data,title:b.title,url:b.url};return m.stringify(b)};a.getStateId=function(b){return a.normalizeState(b).id};a.getHashByState=function(b){return a.normalizeState(b).hash};a.extractId=function(a){return((a=/(.*)\&_suid=([0-9]+)$/.exec(a))?String(a[2]||""):"")||
!1};a.isTraditionalAnchor=function(a){return!/[\/\?\.]/.test(a)};a.extractState=function(b,c){var d=null,e,f;c=c||!1;(e=a.extractId(b))&&(d=a.getStateById(e));d||(f=a.getFullUrl(b),(e=a.getIdByUrl(f)||!1)&&(d=a.getStateById(e)),d||(!c||a.isTraditionalAnchor(b))||(d=a.createStateObject(null,null,f)));return d};a.getIdByUrl=function(b){return a.urlToId[b]||a.store.urlToId[b]||q};a.getLastSavedState=function(){return a.savedStates[a.savedStates.length-1]||q};a.getLastStoredState=function(){return a.storedStates[a.storedStates.length-
1]||q};a.hasUrlDuplicate=function(b){var c=!1;return c=(c=a.extractState(b.url))&&c.id!==b.id};a.storeState=function(b){a.urlToId[b.url]=b.id;a.storedStates.push(a.cloneObject(b));return b};a.isLastSavedState=function(b){var c=!1;a.savedStates.length&&(b=b.id,c=a.getLastSavedState(),c=c.id,c=b===c);return c};a.saveState=function(b){if(a.isLastSavedState(b))return!1;a.savedStates.push(a.cloneObject(b));return!0};a.getStateByIndex=function(b){var c=null;return c="undefined"===typeof b?a.savedStates[a.savedStates.length-
1]:0>b?a.savedStates[a.savedStates.length+b]:a.savedStates[b]};a.getHash=function(){return a.unescapeHash(e.location.hash)};a.unescapeString=function(a){for(var b;;){b=c.decodeURI(a);if(b===a)break;a=b}return a};a.unescapeHash=function(b){b=a.normalizeHash(b);return b=a.unescapeString(b)};a.normalizeHash=function(a){return a.replace(/[^#]*#/,"").replace(/#!*/,"")};a.setHash=function(b,c){var d,f;if(!1!==c&&a.busy())return a.pushQueue({scope:a,callback:a.setHash,args:arguments,queue:c}),!1;d=a.escapeHash(b);
a.busy(!0);(f=a.extractState(b,!0))&&!a.emulated.pushState?a.pushState(f.data,f.title,f.url,!1):e.location.hash!==d&&(a.bugs.setHash?(f=a.getPageUrl(),a.pushState(null,null,f+"#"+d,!1)):e.location.hash=d);return a};a.escapeHash=function(b){b=a.normalizeHash(b);b=c.encodeURI(b);a.bugs.hashEscape||(b=b.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return b};a.getHashByUrl=function(b){b=String(b).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return b=a.unescapeHash(b)};
a.setTitle=function(b){var c=b.title,d;c||(d=a.getStateByIndex(0))&&d.url===b.url&&(c=d.title||a.options.initialTitle);try{e.getElementsByTagName("title")[0].innerHTML=c.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(f){}e.title=c;return a};a.queues=[];a.busy=function(b){"undefined"!==typeof b?a.busy.flag=b:"undefined"===typeof a.busy.flag&&(a.busy.flag=!1);if(!a.busy.flag){k(a.busy.timeout);var c=function(){var b,d;if(!a.busy.flag)for(b=a.queues.length-1;0<=b;--b)d=a.queues[b],
0!==d.length&&(d=d.shift(),a.fireQueueItem(d),a.busy.timeout=g(c,a.options.busyDelay))};a.busy.timeout=g(c,a.options.busyDelay)}return a.busy.flag};a.busy.flag=!1;a.fireQueueItem=function(b){return b.callback.apply(b.scope||a,b.args||[])};a.pushQueue=function(b){a.queues[b.queue||0]=a.queues[b.queue||0]||[];a.queues[b.queue||0].push(b);return a};a.queue=function(b,c){"function"===typeof b&&(b={callback:b});"undefined"!==typeof c&&(b.queue=c);a.busy()?a.pushQueue(b):a.fireQueueItem(b);return a};a.clearQueue=
function(){a.busy.flag=!1;a.queues=[];return a};a.stateChanged=!1;a.doubleChecker=!1;a.doubleCheckComplete=function(){a.stateChanged=!0;a.doubleCheckClear();return a};a.doubleCheckClear=function(){a.doubleChecker&&(k(a.doubleChecker),a.doubleChecker=!1);return a};a.doubleCheck=function(b){a.stateChanged=!1;a.doubleCheckClear();a.bugs.ieDoubleCheck&&(a.doubleChecker=g(function(){a.doubleCheckClear();a.stateChanged||b();return!0},a.options.doubleCheckInterval));return a};a.safariStatePoll=function(){var b=
a.extractState(e.location.href);if(!a.isLastSavedState(b))return b||a.createStateObject(),a.Adapter.trigger(c,"popstate"),a};a.back=function(b){if(!1!==b&&a.busy())return a.pushQueue({scope:a,callback:a.back,args:arguments,queue:b}),!1;a.busy(!0);a.doubleCheck(function(){a.back(!1)});u.go(-1);return!0};a.forward=function(b){if(!1!==b&&a.busy())return a.pushQueue({scope:a,callback:a.forward,args:arguments,queue:b}),!1;a.busy(!0);a.doubleCheck(function(){a.forward(!1)});u.go(1);return!0};a.go=function(b,
c){var d;if(0<b)for(d=1;d<=b;++d)a.forward(c);else if(0>b)for(d=-1;d>=b;--d)a.back(c);else throw Error("History.go: History.go requires a positive or negative integer passed.");return a};if(a.emulated.pushState){var s=function(){};a.pushState=a.pushState||s;a.replaceState=a.replaceState||s}else a.onPopState=function(b,d){var f=!1,f=!1;a.doubleCheckComplete();if(f=a.getHash())return(f=a.extractState(f||e.location.href,!0))?a.replaceState(f.data,f.title,f.url,!1):(a.Adapter.trigger(c,"anchorchange"),
a.busy(!1)),a.expectedStateId=!1;(f=(f=a.Adapter.extractEventData("state",b,d)||!1)?a.getStateById(f):a.expectedStateId?a.getStateById(a.expectedStateId):a.extractState(e.location.href))||(f=a.createStateObject(null,null,e.location.href));a.expectedStateId=!1;if(a.isLastSavedState(f))return a.busy(!1),!1;a.storeState(f);a.saveState(f);a.setTitle(f);a.Adapter.trigger(c,"statechange");a.busy(!1);return!0},a.Adapter.bind(c,"popstate",a.onPopState),a.pushState=function(b,d,e,f){if(a.getHashByUrl(e)&&
a.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==f&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:f}),!1;a.busy(!0);var h=a.createStateObject(b,d,e);a.isLastSavedState(h)?a.busy(!1):(a.storeState(h),a.expectedStateId=h.id,u.pushState(h.id,h.title,h.url),a.Adapter.trigger(c,"popstate"));return!0},a.replaceState=function(b,d,e,f){if(a.getHashByUrl(e)&&a.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
if(!1!==f&&a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:f}),!1;a.busy(!0);var h=a.createStateObject(b,d,e);a.isLastSavedState(h)?a.busy(!1):(a.storeState(h),a.expectedStateId=h.id,u.replaceState(h.id,h.title,h.url),a.Adapter.trigger(c,"popstate"));return!0};if(f)try{a.store=m.parse(f.getItem("History.store"))||{}}catch(t){a.store={}}else a.store={};a.normalizeStore();a.Adapter.bind(c,"beforeunload",a.clearAllIntervals);a.Adapter.bind(c,"unload",a.clearAllIntervals);
a.saveState(a.storeState(a.extractState(e.location.href,!0)));f&&(a.onUnload=function(){var b,c;try{b=m.parse(f.getItem("History.store"))||{}}catch(d){b={}}b.idToState=b.idToState||{};b.urlToId=b.urlToId||{};b.stateToId=b.stateToId||{};for(c in a.idToState)a.idToState.hasOwnProperty(c)&&(b.idToState[c]=a.idToState[c]);for(c in a.urlToId)a.urlToId.hasOwnProperty(c)&&(b.urlToId[c]=a.urlToId[c]);for(c in a.stateToId)a.stateToId.hasOwnProperty(c)&&(b.stateToId[c]=a.stateToId[c]);a.store=b;a.normalizeStore();
f.setItem("History.store",m.stringify(b))},a.intervalList.push(l(a.onUnload,a.options.storeInterval)),a.Adapter.bind(c,"beforeunload",a.onUnload),a.Adapter.bind(c,"unload",a.onUnload));if(!a.emulated.pushState&&(a.bugs.safariPoll&&a.intervalList.push(l(a.safariStatePoll,a.options.safariPollInterval)),"Apple Computer, Inc."===b.vendor||"Mozilla"===(b.appCodeName||""))&&(a.Adapter.bind(c,"hashchange",function(){a.Adapter.trigger(c,"popstate")}),a.getHash()))a.Adapter.onDomLoad(function(){a.Adapter.trigger(c,
"hashchange")})};a.init()})(window);"object"!==typeof JSON&&(JSON={});
(function(){function c(b){return 10>b?"0"+b:b}function q(c){b.lastIndex=0;return b.test(c)?'"'+c.replace(b,function(b){var c=k[b];return"string"===typeof c?c:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function d(b,c){var e,a,k,s,t=f,p,n=c[b];n&&("object"===typeof n&&"function"===typeof n.toJSON)&&(n=n.toJSON(b));"function"===typeof l&&(n=l.call(c,b,n));switch(typeof n){case "string":return q(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";f+=g;p=[];if("[object Array]"===Object.prototype.toString.apply(n)){s=n.length;for(e=0;e<s;e+=1)p[e]=d(e,n)||"null";k=0===p.length?"[]":f?"[\n"+f+p.join(",\n"+f)+"\n"+t+"]":"["+p.join(",")+"]";f=t;return k}if(l&&"object"===typeof l)for(s=l.length,e=0;e<s;e+=1)"string"===typeof l[e]&&(a=l[e],(k=d(a,n))&&p.push(q(a)+(f?": ":":")+k));else for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(k=d(a,n))&&p.push(q(a)+(f?": ":":")+k);k=0===p.length?"{}":f?"{\n"+f+p.join(",\n"+
f)+"\n"+t+"}":"{"+p.join(",")+"}";f=t;return k}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(b){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,k={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(b,c,e){var a;g=f="";if("number"===typeof e)for(a=0;a<e;a+=1)g+=" ";else"string"===typeof e&&(g=e);if((l=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return d("",{"":b})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function d(a,b){var e,f,g=a[b];if(g&&"object"===typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=d(g,e),void 0!==f?g[e]=f:delete g[e]);return c.call(a,b,g)}var a;b=String(b);e.lastIndex=0;e.test(b)&&(b=b.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+b+")"),"function"===typeof c?d({"":a},""):a;throw new SyntaxError("JSON.parse");})})();
